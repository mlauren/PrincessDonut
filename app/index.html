<!-- index.html -->
<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <base href="/" />

  <!-- SCROLLS -->
  <!-- load bootstrap and fontawesome via CDN -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles.css"></script>

  <style>
    a {color:#bb8de2;}
          body {
        color: #888888;
        font-family:Monospace;
        font-size:13px;

        background-color: #000;
        margin: 0px;
        overflow: hidden;
      }
          #info {
        position: absolute;
        top: 0px;
        width: 200px;
        left: calc(50% - 100px);
        text-align: center;
      }
      #webgl {
        margin-top:20px;
      }
  </style>

  
</head>
<body>
  <div id="container"><div id="info">
      Info
    </div></div>
  <div id="webgl"></div>
  
  <!-- SPELLS -->
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="bower_components/three.js/three.js"></script>
  <script src="bower_components/jsSHA/src/sha1.js"></script>
  <script src="scripts/detector.js"></script>
  <script src="scripts/trackBallControls.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect('http://localhost:3030');
    socket.on('news', function (data) {
      console.log(data);
      socket.emit('my other event', { my: 'data' });
    });
  </script>
  <script type="text/javascript">
    $(document).on('ready', function() {
      (function() { 

        var webglEl = document.getElementById('webgl'); 

        console.log(webglEl);
        if (!Detector.webgl) {
          Detector.addGetWebGLMessage(webglEl);
        }
        THREE.ImageUtils.crossOrigin = ''; 
        var width = window.innerWidth,
            height = window.innerHeight;

        var radius=0.45,
            segments=32,
            rotation=5;

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(45, width / height, 0.05, 1000);

        camera.position.z = 15;
        camera.position.y = 2;
        camera.position.x = 2;

        var renderer = new THREE.WebGLRenderer();

        renderer.setSize(width, height);
        scene.add(new THREE.AmbientLight(0x553333));

        var light = new THREE.DirectionalLight(0xffffff, .5);

        light.position.set(2, 3, 9);
        scene.add(light);

        var model = loadModel('models/paraqueet.json');

        // var sphere = createSphere(radius, segments);
        // sphere.rotation.y = rotation;
        // scene.add(model);

        var stars = createStars(90, 64);

        scene.add(stars);

        var controls = new THREE.TrackballControls(camera);

        webglEl.appendChild(renderer.domElement);

        render();

        function render() {
          controls.update();

          // sphere.rotation.y += 0.05;

          requestAnimationFrame(render);
          renderer.render(scene, camera); 
        } 

        function createSphere(radius, segments) {
          return new THREE.Mesh(new THREE.SphereGeometry(radius, segments, segments), new THREE.MeshPhongMaterial({ map: THREE.ImageUtils.loadTexture('https://cdn.rawgit.com/bubblin/The-Solar-System/master/images/page-60/saturnmap.jpg'), bumpScale: 0.05, specular: new THREE.Color('#190909') })); 
        }

        function loadModel(modelsrc) {
          var loader = new THREE.JSONLoader(); // init the loader util
          var bumpMapTexture = THREE.ImageUtils.loadTexture( 'textures/crystal11.jpg' );
          // init loading
          loader.load(modelsrc, function (geometry) {
            var loader = new THREE.JSONLoader(); // init the loader util

            // var mapImage = imgSrc;
            
            bumpMapTexture.wrapS = bumpMapTexture.wrapT = THREE.RepeatWrapping;
            bumpMapTexture.repeat.set( 5, 5 );
            var materialTexture = new THREE.MeshPhongMaterial( { fog: false, bumpMap: bumpMapTexture, bumpScale: 0.3 } );

            // create a mesh with models geometry and material
            var mesh = new THREE.Mesh(
              geometry,
              materialTexture
            );

            mesh.position.x = 0;
            mesh.position.y = 0;
            mesh.position.z = 0;
            
            mesh.name = "simon";
            mesh.scale.set( 1, 1, 1 );

            // mesh.rotateX( Math.PI / 2 );
            scene.add(mesh);
          });

        }

        function createStars(radius, segments) { 
          return new THREE.Mesh(new THREE.SphereGeometry(radius, segments, segments), new THREE.MeshBasicMaterial({ map: THREE.ImageUtils.loadTexture('https://cdn.rawgit.com/bubblin/The-Solar-System/master/images/shared/galaxy_starfield.jpg'), side: THREE.BackSide })); 
        } 
      }());
    });
  </script>
</body>
</html>