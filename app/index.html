<!-- index.html -->
<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <base href="/" />

  <!-- SCROLLS -->
  <!-- load bootstrap and fontawesome via CDN -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles.css"></script>

  <style>
    a {color:#bb8de2;}
          body {
        color: #888888;
        font-family:Monospace;
        font-size:13px;

        background-color: #000;
        margin: 0px;
        overflow: hidden;
      }
          #info {
        position: absolute;
        top: 0px;
        width: 200px;
        left: calc(50% - 100px);
        text-align: center;
      }
      #webgl {
        margin-top:20px;
      }
  </style>

  
</head>
<body>
  <div id="container"><div id="info">
      Info
    </div></div>
  <div id="webgl"></div>
  
  <!-- SPELLS -->
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="bower_components/three.js/three.js"></script>
  <script src="bower_components/jsSHA/src/sha1.js"></script>
  <script src="bower_components/tween.js/src/Tween.js"></script>
  <script src="bower_components/stats.js/src/Stats.js"></script>
  <script src="scripts/detector.js"></script>
  <script src="scripts/trackBallControls.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    /* Set up Socket.io */


  </script>
  <script type="text/javascript">
    $(document).on('ready', function() {
      (function() { 
        var socket = io.connect('http://localhost:3000');
        console.log(socket);

        var camera, controls, scene, mesh, renderer, stats, tween, font = undefined, textGeo, textMesh1;
        /* Set up initial text vars */
        var text = "Tweet @Simon",
            height = 1,
            size = 1,
            hover = 3,
            curveSegments = 5;

        /* Set up initial tweening vars */
        var userOpts  = {
          range : 800,
          duration : 2500,
          delay : 200,
          easing : 'Elastic.EaseInOut'
        };

        init();
        render();

        function init() {
          var webglEl = document.getElementById('webgl'); 

          if (!Detector.webgl) {
            Detector.addGetWebGLMessage(webglEl);
          }

          THREE.ImageUtils.crossOrigin = '';

          var width = window.innerWidth,
              height = window.innerHeight;

          var radius=0.45,
              segments=32,
              rotation=5;

          scene = new THREE.Scene();


          camera = new THREE.PerspectiveCamera(45, width / height, 0.05, 1000);

          camera.position.z = 15;
          camera.position.y = 2;
          camera.position.x = 2;

          renderer = new THREE.WebGLRenderer();

          renderer.setSize(width, height);
          scene.add(new THREE.AmbientLight(0x553333));

          var light = new THREE.DirectionalLight(0xffffff, .5);

          light.position.set(2, 3, 9);
          scene.add(light);

          var loader = new THREE.JSONLoader(); // init the loader util
          // init loading
          loader.load('models/paraqueet.json', function (geometry) {

            // Set beautiful texture
            var bumpMapTexture = THREE.ImageUtils.loadTexture( 'textures/feathers.jpg' );

            // Wrap bumpmap texture
            bumpMapTexture.wrapS = bumpMapTexture.wrapT = THREE.RepeatWrapping;
            bumpMapTexture.repeat.set( 30, 30 );

            var materialTexture = new THREE.MeshPhongMaterial( { fog: false, bumpMap: bumpMapTexture, bumpScale: 0.005} );

            // Create a mesh with models geometry and material
            mesh = new THREE.Mesh(
              geometry,
              materialTexture
            );

            mesh.position.x = 0;
            mesh.position.y = 0;
            mesh.position.z = 0;

            mesh.name = "simon";
            mesh.scale.set( 1, 1, 1 );

            scene.add(mesh);
          });

          console.log(scene);

          /* Set up font material */
          material = new THREE.MultiMaterial( [
            new THREE.MeshPhongMaterial( { color: 0xffffff, shading: THREE.FlatShading } ), // front
            new THREE.MeshPhongMaterial( { color: 0xffffff, shading: THREE.SmoothShading } ) // side
          ] );

          /* Set up font Group */
          group = new THREE.Group();
          group.position.y = 0;

          scene.add( group );

          /* Load the fonts */
          loadFont();


          //* Make some text then tween it *//
          socket.on('tweet', function (data) {
            console.log(data);
            text = data.message;
            loadFont();

          });




          // var simon = scene.getObjectByName( "simon" );

          var stars = createStars(90, 64);

          scene.add(stars);

          controls = new THREE.TrackballControls(camera);

          webglEl.appendChild(renderer.domElement);

          // tween.start();
          // init the Stats and append it to the Dom - performance vuemeter
          stats = new Stats();
          stats.domElement.style.position = 'absolute';
          stats.domElement.style.top = '0px';
          container.appendChild( stats.domElement );
        }

        function loadFont() {
          loader = new THREE.FontLoader();
          loader.load( 'fonts/Montserrat_Bold.typeface.js', function ( response ) {
            console.log(response);
            font = response;

            createText();

          });

        }

        function createText() {
          group.remove( textMesh1 );
          textGeo = new THREE.TextGeometry( text, {

            font: font,

            size: size,
            height: height,
            curveSegments: curveSegments,

            material: 0,
            extrudeMaterial: 1

          });

          textGeo.computeBoundingBox();
          textGeo.computeVertexNormals();

          var centerOffset = -0.5 * ( textGeo.boundingBox.max.x - textGeo.boundingBox.min.x );

          textMesh1 = new THREE.Mesh( textGeo, material );

          textMesh1.position.x = centerOffset;
          textMesh1.position.y = hover;
          textMesh1.position.z = 0;

          textMesh1.rotation.x = 0;
          textMesh1.rotation.y = Math.PI * 2;

          group.add( textMesh1 );
        }

        function render() {
          controls.update();

          // sphere.rotation.y += 0.05;

          requestAnimationFrame(render);
          renderer.render(scene, camera); 
          
          stats.update();
          // update the tweens from TWEEN library
          TWEEN.update();

        } 

        function createSphere(radius, segments) {
          return new THREE.Mesh(new THREE.SphereGeometry(radius, segments, segments), new THREE.MeshPhongMaterial({ map: THREE.ImageUtils.loadTexture('https://cdn.rawgit.com/bubblin/The-Solar-System/master/images/page-60/saturnmap.jpg'), bumpScale: 0.05, specular: new THREE.Color('#190909') })); 
        }

        function createStars(radius, segments) { 
          return new THREE.Mesh(new THREE.SphereGeometry(radius, segments, segments), new THREE.MeshBasicMaterial({ map: THREE.ImageUtils.loadTexture('https://cdn.rawgit.com/bubblin/The-Solar-System/master/images/shared/galaxy_starfield.jpg'), side: THREE.BackSide })); 
        } 
      }());
    });
  </script>
</body>
</html>